@page "/Product/{slug}"
@using MyBlazorLibraries.Product
@using MyBlazorLibraries.Product.Models
@inject IProductService productService

@if(Product != null)
{
    <PageTitle>@Product.Name</PageTitle>
}


    @if(Product == null)
    {
        <div class="alert alert-warning">
            <h2>محصول مورد نظر پیدا نشد</h2>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-3">
                <img src="/Img/@Product.Image" class="img-thumbnail" style="width:100%"/>
            </div>
            <div class="col-9">
                <h2>@Product.Name</h2>
                <hr />
                <p class="text-success">قیمت: @Product.Price €</p>
                <ul>
                    @foreach(var product in ListProduct)
                    {
                        <li>
                            <a href="@product.FullUrl">
                                @product.Name
                            </a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    }


<div class="row">
    <h2>دیگر محصولات ما</h2>
    <hr />
    @foreach(var product in ListProduct)
    {
        <ProductItem Product="product"/>
    }
</div>

@code {
    public ProductModel? Product { get; set; }
    public IList<ProductModel>? ListProduct { get; set; }

    [Parameter]
    public string? slug { get; set; }

    protected override void OnInitialized()
    {
        ListProduct = productService.GetAll();
        if(!string.IsNullOrEmpty(slug))
        {
            Product = productService.GetProductBySlug(slug);
        }
        base.OnInitialized();

    }

    protected override void OnParametersSet()
    {
        if (!string.IsNullOrEmpty(slug))
        {
            Product = productService.GetProductBySlug(slug);
        }
        base.OnInitialized();
        base.OnParametersSet();
    }
}
